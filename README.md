# React Native Expo Builder
This repository contains scripts to generate a macOS Vagrant box to use for building expo based react native apps as ipa's to submit to the AppStore.

This uses a base box generated by [macinbox](https://github.com/bacongravy/macinbox), then adds
dependencies needed to build WAVES, such as node.js, homebrew, and xcode

*Use only in accordance with the Apple SLAs: https://www.apple.com/legal/sla/.*

These boxes are built for use with [VirtualBox](https://www.virtualbox.org/).

Defaults:

* 4 GB of memory
* 2 CPUs
* 64 GB dynamically-allocated disk
* APFS (Apple File System)
* username: `vagrant`
* password: `vagrant`

# Create a base box

## Download a macOS Installer
First, download the macOS installer you would like to use as a base image.

## Create the base box
Here the base box will be given the name `macos-base`. If you change this value, ensure
you also change the value in `./create-box.sh`

```
./create-vm.sh macos-base /Applications/Install\ macOS\ Catalina.app
```

## Start the box
```
vagrant init macos-base && vagrant up
```

## Add Dependencies
To build the box that can perform ipa builds box you will need to install the following:

- nodejs
- homebrew
- yarn
- xcode
- xcode developer tools

### Xcode
Installing Xcode involves multiple steps:
1. Install the correct version of Xcode for the version of macOS on the box. 
2. Install the command line tools by visiting the apple developer site https://developer.apple.com/download/more/?=command%20line%20tools
3. Open Xcode to ensure all of the appropriate licenses have been accepted
4. Ensure `xcodebuild` has the right path to the Xcode command line tools

```shell
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
```

## Shutdown the box
```
vagrant halt
```

## Create a new vagrant box using the modified box

```
./create-box.sh macos-base expo-builder.box
```

## Publish the box
Once you're happy with the configuration of the box, publish the box

```
./publish-box.sh expo-builder ./expo-builder.box 1.0.0 "Builder box using macOS Catalina and xcode 12.1"
```

## FAQs

### How do I get started?

You can quickly start using `vagrant init [box name]`. For example:

    vagrant init xylophone/expo-builder

### How do I SSH to the VM?

Use the `vagrant ssh` command.

### How can I launch the GUI to click around in the macOS VM?

Add the following to your Vagrantfile:

``` ruby
config.vm.provider "virtualbox" do |vb|
  vb.gui = true
end
```

If you've already started the VM, reload the configuration with
`vagrant reload`. VirtualBox will now launch the GUI, where you may log in
and click around.
